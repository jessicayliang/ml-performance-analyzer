apiVersion: v1
kind: ConfigMap
metadata:
    name: llm-peruser-dashboard
    labels:
        grafana_dashboard: "1"
data:
    llm-peruser-dashboard.json: |
        {
          "uid": "llm-peruser-dashboard",
          "title": "LLM Metrics Per User",
          "schemaVersion": 37,
          "version": 2,
          "tags": ["llm-monitoring"],
          "templating": { "list": [ { "name": "user_id", "type": "query", "datasource": "Prometheus", "refresh": 1, "query": "label_values(llm_request_count_total, user_id)", "multi": true, "includeAll": true, "current": { "text": "All", "value": "$__all" }} ] },
          "panels": [
            { "title": "Requests (Last 5m)", "type": "timeseries", "fieldConfig": {"defaults": {"custom": {"axisLabel": "Requests"}}}, "targets": [ { "expr": "increase(llm_request_count_total{user_id=~\"$user_id\"}[5m])" } ], "gridPos": {"x":0,"y":0,"w":12,"h":8} },
            { "title": "Average Request Latency", "type": "timeseries", "fieldConfig": {"defaults": {"unit": "s", "custom": {"axisLabel": "Latency"}}}, "targets": [ { "expr": "rate(llm_request_latency_seconds_sum{user_id=~\"$user_id\"}[1m]) / rate(llm_request_latency_seconds_count{user_id=~\"$user_id\"}[1m])" } ], "gridPos": {"x":12,"y":0,"w":12,"h":8} },
            { "title": "Average Time to First Token", "type": "timeseries", "fieldConfig": {"defaults": {"unit": "s", "custom": {"axisLabel": "Time to First Token (s)"}}}, "targets": [ { "expr": "rate(llm_time_to_first_token_seconds_sum{user_id=~\"$user_id\"}[1m]) / rate(llm_time_to_first_token_seconds_count{user_id=~\"$user_id\"}[1m])" } ], "gridPos": {"x":0,"y":8,"w":12,"h":8} },
            { "title": "Tokens Generated (Last 5m)", "type": "timeseries", "fieldConfig": {"defaults": {"unit": "tokens", "custom": {"axisLabel": "Tokens"}}}, "targets": [ { "expr": "increase(llm_tokens_generated_total{user_id=~\"$user_id\"}[5m])" } ], "gridPos": {"x":0,"y":8,"w":12,"h":8} },
            { "title": "Inference Errors (Last 5m)", "type": "timeseries", "fieldConfig": {"defaults": {"unit": "errors", "custom": {"axisLabel": "Errors"}}}, "targets": [ { "expr": "increase(llm_error_count_total{user_id=~\"$user_id\"}[5m])" } ], "gridPos": {"x":12,"y":8,"w":12,"h":8} },
            { "title": "Num Limit Breaches (Last 5m)", "type": "timeseries", "fieldConfig": {"defaults": {"unit": "breaches", "custom": {"axisLabel": "Breaches"}}}, "targets": [ { "expr": "increase(llm_rate_limit_breaches_total{user_id=~\"$user_id\"}[5m])" } ], "gridPos": {"x":0,"y":16,"w":24,"h":8} }
          ]
        }
